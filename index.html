<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>UAE Pass smart link (stage)</title>

  <!-- iOS Smart‑App‑Banner; keep the deeplink blank until you know it. -->
  <meta name="apple-itunes-app" content="app-id=1377158818, app-argument=UAEPASS_DEEPLINK_GOES_HERE" />

  <style>
    :root{font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Helvetica,Arial,sans-serif}
    body{display:flex;justify-content:center;align-items:center;min-height:100vh;margin:0;background:#f4f4f9;color:#333}
    .card{padding:2.5rem 2rem;background:#fff;border-radius:12px;box-shadow:0 6px 14px rgba(0,0,0,.12);text-align:center}
    h1{margin-top:0;color:#0060ff;font-size:1.6rem}
    #msg{margin:.75rem 0 1.5rem;font-size:1.05rem;line-height:1.55}
    .spin{width:42px;height:42px;border-radius:50%;border:5px solid rgba(0,0,0,.1);border-left-color:#0060ff;animation:spin 1s linear infinite;margin:0 auto}
    @keyframes spin{to{transform:rotate(360deg)}}
    .links{display:none;margin-top:2rem}
    .links a{display:inline-block;margin:0 .75rem;font-size:.9rem;text-decoration:none;color:#0060ff}
    .links a:hover{text-decoration:underline}
  </style>
</head>
<body>
  <div class="card">
    <h1>Opening UAE Pass…</h1>
    <div id="msg">Checking your device…</div>
    <div class="spin" id="spinner"></div>
    <div class="links" id="manual">
      <p>If nothing happens, tap the right store:</p>
      <a id="iosStore"     href="https://apps.apple.com/ae/app/uae-pass/id1377158818">App Store</a>
      <a id="androidStore" href="https://play.google.com/store/apps/details?id=ae.uaepass.mainapp&hl=en">Google Play</a>
    </div>
  </div>

<script>
// ————— CONFIG —————
const CONF = {
  // 1️⃣ Android staging deep‑link (works if the STG app is installed)
  androidScheme:  'uaepassstg://presentment/?clientid=digivault_stage&requestid=dv12345678&successurl=&failureurl=',

  // 2️⃣ Intent wrapper = automatic Play‑Store fallback when not installed
  androidIntent: 'intent://presentment/?clientid=digivault_stage&requestid=dv12345678&successurl=&failureurl=#Intent;scheme=uaepassstg;package=ae.uaepass.mainapp;end',

  // 3️⃣ iOS deep‑link — leave blank for now, fill it once confirmed
  iosScheme: 'UAEPASS_DEEPLINK_GOES_HERE',

  iosStore:  'https://apps.apple.com/ae/app/uae-pass/id1377158818',
  playStore: 'https://play.google.com/store/apps/details?id=ae.uaepass.mainapp&hl=en',
  wait: 1800 // ms before assuming the app didn’t open
};

// ————— DOM refs —————
const msg     = document.getElementById('msg');
const spinner = document.getElementById('spinner');
const manual  = document.getElementById('manual');

function detectOS(){
  const ua = navigator.userAgent || navigator.vendor || window.opera;
  if (/android/i.test(ua))             return 'android';
  if (/iPad|iPhone|iPod/.test(ua))     return 'ios';
  return 'other';
}

function openApp(){
  const os = detectOS();
  let hidden = false;
  const start = Date.now();

  document.addEventListener('visibilitychange',() => hidden = document.hidden);

  if (os === 'android'){
    location.href = CONF.androidIntent;      // single shot handles both open & fallback
  } else if (os === 'ios'){
    if (CONF.iosScheme && CONF.iosScheme !== 'UAEPASS_DEEPLINK_GOES_HERE'){
      location.href = CONF.iosScheme;
    } else {
      fallback('ios'); return;
    }
  } else {
    fallback('other'); return;
  }

  setTimeout(()=>{
    if (!hidden && Date.now() - start < CONF.wait + 500){
      fallback(os);
    }
  }, CONF.wait);
}

function fallback(os){
  spinner.style.display = 'none';
  manual.style.display  = 'block';
  if (os === 'ios'){
    msg.textContent = 'Redirecting to the App Store…';
    location.href = CONF.iosStore;
  } else if (os === 'android'){
    msg.textContent = 'Redirecting to Google Play…';
    // In most browsers the intent URI already did this; this is a safety net
    setTimeout(()=>location.href = CONF.playStore, 200);
  } else {
    msg.textContent = 'Please open this link on your phone and install UAE Pass.';
  }
}

window.addEventListener('load', openApp);
</script>
</body>
</html>
